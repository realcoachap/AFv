// Personal Training Client Management System
// Database Schema - MVP Phase

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// User accounts (both admin and clients)
model User {
  id        String   @id @default(cuid())
  email     String   @unique
  password  String   // Will be hashed with bcrypt
  role      Role     @default(CLIENT)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  clientProfile     ClientProfile?
  appointmentsAsClient Appointment[] @relation("ClientAppointments")
  appointmentsAsAdmin  Appointment[] @relation("AdminAppointments")

  @@index([email])
  @@index([role])
}

enum Role {
  ADMIN
  CLIENT
}

// Client profile data (extended info for clients)
model ClientProfile {
  id        String   @id @default(cuid())
  userId    String   @unique
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  // Personal Information
  fullName          String
  phone             String
  email             String?
  age               Int?
  gender            String?              // "Male", "Female", "Prefer not to say"
  height            Float?               // Stored in inches (convert from cm if needed)
  heightUnit        String?              // "inches" or "centimeters"
  currentWeight     Float?
  weightUnit        String?              // "pounds" or "kilograms"
  
  // Emergency Contact
  emergencyContact        String?
  emergencyPhone          String?
  emergencyRelationship   String?        // "Spouse", "Parent", "Sibling", "Friend", "Other"
  
  // Health & Medical
  hasMedicalConditions    Boolean?
  medicalConditions       String?        // Description if hasMedicalConditions = true
  isTakingMedications     Boolean?
  medications             String?        // Description if isTakingMedications = true
  hasInjuries             Boolean?
  injuriesDescription     String?        // Description if hasInjuries = true
  hasAllergies            Boolean?
  allergies               String?        // Description if hasAllergies = true
  fitnessLevel            String?        // "Beginner", "Intermediate", "Advanced"
  
  // Fitness History
  hasWorkedOutBefore      Boolean?
  previousExerciseTypes   String?        // Types of exercise done before
  hasHomeEquipment        Boolean?
  homeEquipmentTypes      String?        // Description if hasHomeEquipment = true
  
  // Goals
  primaryGoal             String?        // Main fitness goal
  secondaryGoals          String?        // Additional goals
  targetTimeline          String?        // Timeline for achieving goals
  
  // Lifestyle
  typicalActivityLevel    String?        // "Sedentary", "Light Active", "Active", "Very Active"
  averageSleepHours       Float?
  dietaryRestrictions     String?        // Dietary restrictions or allergies
  
  // Preferences
  exerciseDaysPerWeek     Int?
  preferredWorkoutDays    String?        // Days and times preferred
  sessionsPerMonth        Int?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([userId])
  @@index([fullName])
}

// Appointment/Session scheduling
model Appointment {
  id        String   @id @default(cuid())
  
  // Who and when
  clientId  String
  client    User     @relation("ClientAppointments", fields: [clientId], references: [id], onDelete: Cascade)
  
  adminId   String?  // Nullable - not set until admin approves/creates
  admin     User?    @relation("AdminAppointments", fields: [adminId], references: [id])
  
  dateTime  DateTime
  duration  Int      @default(60) // Duration in minutes
  
  // Session Details
  sessionType SessionType @default(ONE_ON_ONE)
  location    String?     // "LA Fitness", "Client Home", "Virtual", etc.
  
  // Status tracking
  status    AppointmentStatus @default(PENDING_APPROVAL)
  
  // Booking metadata
  bookedBy  BookedBy  // Track if client self-booked or admin created
  
  // Communication
  whatsappNotificationSent Boolean @default(false)
  whatsappReminderSent     Boolean @default(false)
  
  // Notes
  notes           String?  // Admin notes about the session
  clientNotes     String?  // Client's notes when booking (reason, preferences, etc.)
  rejectionReason String?  // If admin rejects, optional reason
  
  // Cancellation tracking
  cancelledAt     DateTime?
  cancelReason    String?   // Reason for cancellation
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([clientId])
  @@index([adminId])
  @@index([dateTime])
  @@index([status])
  @@index([sessionType])
}

enum AppointmentStatus {
  PENDING_APPROVAL  // Client booked, waiting for admin approval
  CONFIRMED         // Admin approved (or admin created directly)
  COMPLETED         // Session finished
  CANCELLED         // Cancelled by either party
  REJECTED          // Admin declined the booking request
  NO_SHOW           // Client didn't show up
}

enum BookedBy {
  CLIENT  // Client self-booked (needs approval)
  ADMIN   // Admin created directly (auto-confirmed)
}

enum SessionType {
  ONE_ON_ONE      // Standard 1-on-1 training session
  GROUP           // Group training class
  ASSESSMENT      // Initial assessment / consultation
  CHECK_IN        // Progress check-in / weigh-in
}
