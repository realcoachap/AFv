# Comprehensive Research: Nutritional Guidance Systems for Fitness Athletes

## Executive Summary

This research provides evidence-based nutritional guidance for a fitness RPG app, covering macro/micronutrient optimization, meal timing, hydration, cost-effective solutions, and integration strategies. All recommendations are backed by peer-reviewed studies with practical implementation formulas and code.

---

## 1. Macro/Micronutrient Optimization

### 1.1 Protein Requirements (Scientific Consensus)

**Key Finding**: The International Society of Sports Nutrition (ISSN) Position Stand (PMC2117006) establishes the gold standard for protein intake:

| Goal | Protein Intake | Scientific Basis |
|------|---------------|------------------|
| Sedentary Maintenance | 0.8-1.2 g/kg/day | RDA / IAAO studies |
| Endurance Athletes | 1.0-1.6 g/kg/day | Exercise oxidation compensation |
| Strength/Muscle Gain | 1.6-2.2 g/kg/day | Optimal for muscle protein synthesis |
| Fat Loss (Preservation) | 2.3-3.1 g/kg/day | Minimizes lean mass loss during deficit |

**Critical Research Findings:**
- Lambert et al. (2004): Higher protein intake (30% of calories) reduces lean mass loss during energy restriction compared to 15%
- Slater et al. (2019): Bodybuilders should target 1.6-2.2 g/kg/day, with 0.40-0.55 g/kg per meal distributed across 3-6 meals
- Examine.com analysis: 1.6-2.2 g/kg/day optimal for muscle growth; >3.0 g/kg/day may provide body composition benefits during cutting

### 1.2 Carbohydrate Requirements

**Evidence-Based Recommendations:**
- **Off-season/Muscle Building**: 55-60% of total calories (≥3-5 g/kg/day)
- **Pre-contest/Fat Loss**: Maintain 55-60% to preserve training intensity
- **Post-workout**: 1.2 g/kg/hour at 30-minute intervals for 4 hours (high GI)

**Research Support:**
- Lambert et al. (2004): Adequate carbohydrate (55-60%) maintains training intensity during both off-season and pre-contest phases
- Low glycemic load diets reduce intra-abdominal fat by 11% independent of weight change (PMC3735822)

### 1.3 Fat Requirements

**Scientific Consensus:**
- **Range**: 15-20% of total calories (0.5-1.5 g/kg/day)
- **Minimum**: Not below 15% to maintain testosterone production
- **Upper Limit**: Saturated fat moderation for cardiovascular health

### 1.4 Micronutrient Priorities for Athletes

**Priority 1 - Iron:** Critical for oxygen transport; deficiency impairs performance
**Priority 2 - Vitamin D:** Muscle function, bone health, immune support
**Priority 3 - Calcium:** Bone density, muscle contraction
**Priority 4 - B-Vitamins:** Energy metabolism
**Priority 5 - Zinc/Magnesium:** Testosterone production, recovery

---

## 2. Meal Timing Strategies

### 2.1 Pre/Post Workout Nutrition ("Anabolic Window")

**Research Reality:** The anabolic window is wider than traditionally taught.

**Pre-Workout (1-2 hours before):**
- Protein: 0.25-0.4 g/kg
- Carbohydrates: 1-2 g/kg
- Hydration: 500ml water

**Post-Workout (within 2 hours):**
- Protein: 0.25-0.4 g/kg (with 3g+ leucine optimal)
- Carbohydrates: 0.5-1.2 g/kg (higher for glycogen replenishment)
- 3:1 carb-to-protein ratio for recovery

### 2.2 Meal Frequency & Distribution

**Evidence-Based Approach:**
- **3-6 meals per day** (Slater et al. 2019)
- **Protein per meal**: 0.40-0.55 g/kg to maximize muscle protein synthesis
- **Leucine threshold**: 2-3g per meal minimum for MPS stimulation

### 2.3 Intermittent Fasting for Athletes

**Key Considerations:**
- Time-restricted eating (16:8) can work for muscle maintenance
- Protein distribution challenges with compressed eating window
- May impair muscle gain in advanced athletes
- Better suited for fat loss phases than muscle building

---

## 3. Evidence-Based Nutrition Protocols

### 3.1 IIFYM (If It Fits Your Macros)

**Scientific Backing:**
- Flexible approach improves adherence (PMC9662257)
- No significant difference in body composition vs rigid "clean eating" when macros matched
- Psychological benefit: reduces binge-eating episodes

**Implementation:**
- Set protein target (priority)
- Set calorie target based on goal
- Fill remaining calories with carbs/fats based on preference
- Minimum 80% whole foods recommended for micronutrients

### 3.2 Zone Diet (40/30/30)

**Evidence:**
- Popularized by Barry Sears
- Some evidence for inflammation reduction
- Not superior to other isocaloric diets for body composition
- May be overly restrictive for high-volume athletes

### 3.3 Ketogenic Diet for Athletes

**Scientific Reality:**
- Generally NOT recommended for strength/hypertrophy athletes
- May preserve muscle during severe deficits
- Impairs high-intensity performance (>80% VO2 max)
- Adaptation period: 3-4 weeks minimum

**When to Consider:**
- Endurance athletes in specific training phases
- Medical conditions (epilepsy, metabolic syndrome)
- Individuals who prefer the cognitive effects

---

## 4. Calorie Cycling & Refeed Strategies

### 4.1 Metabolic Adaptation Science

**Research Findings (PMC9662257):**
- Adaptive thermogenesis occurs during prolonged deficits
- Leptin levels drop with calorie restriction and body fat reduction
- Strategic refeeds help maintain hormonal function

### 4.2 Calorie Cycling Protocols

**Weekly Calorie Cycling:**
```
Training Days: Maintenance + 10-20%
Rest Days: Maintenance - 20-30%
Weekly Average: Target deficit/surplus
```

**Refeed Day Protocol:**
- Double carbohydrate intake
- Keep protein constant
- Reduce fat to compensate
- Frequency: Every 7-14 days during deficits >20%

### 4.3 Diet Breaks

**Scientific Recommendation:**
- 1-2 week diet breaks every 8-12 weeks of deficit
- Return to maintenance calories
- Psychological and physiological benefits
- Prevents metabolic slowdown

---

## 5. Hydration & Electrolyte Optimization

### 5.1 Hydration Guidelines

**General Recommendations:**
- **Baseline**: 35-40 ml/kg body weight daily
- **During Exercise**: 150-250 ml every 15-20 minutes
- **Post-Exercise**: 150% of fluid lost (sweat rate dependent)

### 5.2 Electrolyte Requirements (PMC6213308)

**Optimal Ratios for Athletes:**
| Electrolyte | Standard Training | High Intensity (>2hrs) |
|-------------|-------------------|------------------------|
| Sodium | 200-400 mg/hour | 400-800 mg/hour |
| Potassium | 150-300 mg/serving | 250-350 mg/serving |
| Magnesium | 50-100 mg/serving | 75-100 mg/serving |
| Sodium:Potassium Ratio | 2:1 to 4:1 | 2:1 to 4:1 |

**Key Finding (Precision Hydration):** Sodium is the critical electrolyte for hydration; others are secondary.

### 5.3 Sweat Rate Testing Protocol

```
1. Weigh yourself nude before exercise (kg)
2. Exercise for 60 minutes
3. Do not consume fluids during test
4. Weigh yourself nude after exercise (kg)
5. Sweat rate = (Pre - Post) × 1000 = ml/hour
6. Add urine volume if applicable
```

---

## 6. Cost-Effective Nutrition Solutions

### 6.1 Budget Protein Sources (Cost per 25g Protein)

| Food | Approximate Cost | Protein Quality |
|------|-----------------|-----------------|
| Chicken thighs | $0.80-1.20 | High (PDCAAS: 0.98) |
| Eggs | $0.90-1.30 | High (PDCAAS: 1.0) |
| Canned tuna | $0.70-1.00 | High (PDCAAS: 0.99) |
| Lentils/beans | $0.30-0.50 | Moderate (combine with grains) |
| Greek yogurt (bulk) | $1.00-1.50 | High |
| Whey protein (bulk) | $0.80-1.20 | Highest (PDCAAS: 1.0) |
| Milk | $0.60-0.90 | High |

### 6.2 Budget Carbohydrate Sources

| Food | Cost per 50g Carbs | Notes |
|------|-------------------|-------|
| Rice (bulk) | $0.20-0.30 | Buy 10-20lb bags |
| Oats | $0.15-0.25 | Great for breakfast |
| Potatoes | $0.30-0.50 | Nutrient-dense |
| Pasta | $0.20-0.35 | Versatile |
| Bananas | $0.40-0.60 | Pre-workout ideal |

### 6.3 Bulk Buying Strategies

1. **Protein**: Buy frozen chicken/meat in bulk during sales
2. **Carbs**: 20-50lb bags of rice/oats significantly cheaper
3. **Frozen vegetables**: Equal nutrition, less waste, lower cost
4. **Generic brands**: Same macros, 30-50% savings
5. **Meal prep**: Prevents expensive convenience food purchases

---

## 7. Integration with Workout Tracking

### 7.1 Nutrition Timing Around Training

**Pre-Workout (60-90 min before):**
```javascript
{
  protein: bodyweight_kg * 0.25, // grams
  carbs: bodyweight_kg * 1.0,    // grams (lower fat loss phase)
  fat: bodyweight_kg * 0.15,     // grams (keep low)
  caffeine: 3-6 * bodyweight_kg  // mg (optional)
}
```

**Post-Workout (within 2 hours):**
```javascript
{
  protein: bodyweight_kg * 0.4,  // grams
  carbs: bodyweight_kg * 0.8,    // grams (higher if endurance)
  leucine_min: 2.5,              // grams minimum
  hydration_ratio: 1.5           // × sweat loss
}
```

### 7.2 Calorie Adjustment Based on Training Volume

**Daily Calorie Modification:**
```
Base TDEE: Calculated from Mifflin-St Jeor or Katch-McArdle

Training Day Modifier:
- Light (<30 min): +0%
- Moderate (30-60 min): +5-10%
- High (60-90 min): +10-15%
- Very High (>90 min): +15-20%

Rest Day Modifier:
- Recovery day: -10-15%
- Complete rest: -15-20%
```

---

## 8. Behavior & Psychology of Adherence

### 8.1 Key Research Findings (PMC9662257, PMC7067534)

**Predictors of Success:**
1. **Self-regulation skills** - Most important predictor
2. **Self-efficacy** - Belief in ability to execute behaviors
3. **Mood management** - Exercise improves eating behaviors through mood
4. **Habit formation** - Automaticity reduces cognitive load
5. **Social support** - Accountability structures

**Predictors of Failure:**
1. **Dietary restraint** - Rigid restriction predicts weight REGAIN
2. **Disinhibition** - Loss of control episodes
3. **Emotional eating** - Using food to cope with emotions
4. **Unrealistic expectations** - Rapid loss expectations

### 8.2 Sustainable vs. Crash Diet Psychology

**Sustainable Approach Characteristics:**
- Modest calorie deficits (300-500 kcal/day)
- Flexible food choices (80/20 rule)
- Gradual habit formation
- Regular diet breaks
- Focus on process, not just outcomes
- Self-compassion for setbacks

**Crash Diet Risks:**
- 95% regain within 1-5 years
- Metabolic adaptation
- Disordered eating patterns
- Muscle loss
- Psychological distress

### 8.3 Adherence Strategies for App Design

1. **Micro-habits**: Start with 1-2 small changes
2. **Streak tracking**: Visual progress indicators
3. **Flexible goals**: Range-based targets vs rigid numbers
4. **Educational content**: Explain the "why"
5. **Community features**: Social accountability
6. **Non-scale victories**: Track energy, strength, mood
7. **Adaptive coaching**: Adjust based on compliance

---

## 9. Browser/App-Based Tools & APIs

### 9.1 Available Nutrition APIs

#### Edamam Nutrition API
- **Pricing**: $19/month (200 searches/minute)
- **Features**: Nutrition analysis, food database, recipe parsing
- **API Type**: REST + GraphQL
- **Data Source**: USDA + branded foods
- **Best For**: Recipe analysis, food logging

#### Nutritionix API
- **Pricing**: $299/month (starter)
- **Features**: Natural language processing, branded foods, restaurant data
- **API Type**: REST
- **Strength**: NLP food entry ("2 eggs and toast")
- **Best For**: Natural language food logging

#### FatSecret API
- **Pricing**: Free tier available
- **Features**: Food database, barcode scanning
- **Integration**: Direct health app integrations
- **Best For**: Cost-conscious implementations

#### USDA FoodData Central API
- **Pricing**: FREE
- **Features**: Comprehensive nutrient data, 350,000+ foods
- **Limitations**: No branded foods, limited restaurant data
- **Best For**: Budget implementations, whole foods focus

### 9.2 API Comparison Matrix

| Feature | Edamam | Nutritionix | FatSecret | USDA |
|---------|--------|-------------|-----------|------|
| Free Tier | Limited | No | Yes | Yes |
| Branded Foods | Yes | Extensive | Yes | No |
| NLP | Limited | Yes | No | No |
| Recipe Analysis | Yes | No | No | No |
| Barcode | No | Yes | Yes | No |
| Restaurant | Limited | Yes | Limited | No |

### 9.3 MyFitnessPal/Cronometer Integration Status

**MyFitnessPal:**
- API is now PRIVATE (requires approval)
- Contact: API@myfitnesspal.com
- Recently restricted third-party integrations
- Barcode scanner now paywalled

**Cronometer:**
- NO public API available
- Some third-party sync via Vital (expensive)
- User frustration around data portability

**Recommendation**: Build around open APIs (USDA, Edamam) rather than depending on proprietary platforms.

---

## 10. Implementation Code for Fitness RPG App

### 10.1 Macro Calculator Module

```typescript
// nutrition/calculator.ts

interface UserProfile {
  weight_kg: number;
  height_cm: number;
  age: number;
  gender: 'male' | 'female';
  activity_level: 'sedentary' | 'light' | 'moderate' | 'active' | 'very_active';
  goal: 'lose' | 'maintain' | 'gain';
  body_fat_percentage?: number;
}

interface MacroTargets {
  calories: number;
  protein_g: number;
  carbs_g: number;
  fat_g: number;
  fiber_g: number;
}

export class MacroCalculator {
  // Mifflin-St Jeor Equation (most accurate for general population)
  static calculateBMR(profile: UserProfile): number {
    const { weight_kg, height_cm, age, gender } = profile;
    
    let bmr = (10 * weight_kg) + (6.25 * height_cm) - (5 * age);
    bmr += gender === 'male' ? 5 : -161;
    
    return Math.round(bmr);
  }
  
  // Katch-McArdle (more accurate if body fat % known)
  static calculateBMR_KatchMcArdle(profile: UserProfile): number {
    if (!profile.body_fat_percentage) {
      return this.calculateBMR(profile);
    }
    
    const lean_mass_kg = profile.weight_kg * (1 - profile.body_fat_percentage / 100);
    return Math.round(370 + (21.6 * lean_mass_kg));
  }
  
  static calculateTDEE(profile: UserProfile): number {
    const bmr = profile.body_fat_percentage 
      ? this.calculateBMR_KatchMcArdle(profile)
      : this.calculateBMR(profile);
    
    const activityMultipliers = {
      sedentary: 1.2,
      light: 1.375,
      moderate: 1.55,
      active: 1.725,
      very_active: 1.9
    };
    
    return Math.round(bmr * activityMultipliers[profile.activity_level]);
  }
  
  static calculateMacros(profile: UserProfile): MacroTargets {
    const tdee = this.calculateTDEE(profile);
    
    // Calorie adjustment based on goal
    let targetCalories = tdee;
    switch (profile.goal) {
      case 'lose':
        targetCalories = tdee - 500; // ~0.5kg/week loss
        break;
      case 'gain':
        targetCalories = tdee + 300; // Conservative surplus
        break;
      case 'maintain':
      default:
        targetCalories = tdee;
    }
    
    // Protein calculation based on goal (g/kg)
    let proteinPerKg: number;
    switch (profile.goal) {
      case 'lose':
        proteinPerKg = 2.2; // Higher to preserve muscle
        break;
      case 'gain':
        proteinPerKg = 1.8; // Moderate for muscle building
        break;
      case 'maintain':
      default:
        proteinPerKg = 1.6;
    }
    
    const protein_g = Math.round(profile.weight_kg * proteinPerKg);
    const protein_cals = protein_g * 4;
    
    // Fat: 20-25% of calories
    const fat_percentage = 0.22;
    const fat_cals = targetCalories * fat_percentage;
    const fat_g = Math.round(fat_cals / 9);
    
    // Remaining calories from carbs
    const remaining_cals = targetCalories - protein_cals - fat_cals;
    const carbs_g = Math.round(remaining_cals / 4);
    
    // Fiber: 10-15g per 1000 calories
    const fiber_g = Math.round((targetCalories / 1000) * 14);
    
    return {
      calories: Math.round(targetCalories),
      protein_g,
      carbs_g,
      fat_g,
      fiber_g
    };
  }
  
  // Adjust macros based on training day
  static adjustForTrainingDay(
    baseTargets: MacroTargets, 
    trainingIntensity: 'none' | 'light' | 'moderate' | 'high'
  ): MacroTargets {
    const multipliers = {
      none: 0.85,    // Rest day
      light: 1.0,
      moderate: 1.1,
      high: 1.15
    };
    
    const multiplier = multipliers[trainingIntensity];
    const adjustedCals = Math.round(baseTargets.calories * multiplier);
    
    // Keep protein constant, adjust carbs primarily
    const calDiff = adjustedCals - baseTargets.calories;
    const carbAdjustment = Math.round(calDiff / 4);
    
    return {
      calories: adjustedCals,
      protein_g: baseTargets.protein_g,
      carbs_g: Math.max(50, baseTargets.carbs_g + carbAdjustment),
      fat_g: baseTargets.fat_g,
      fiber_g: baseTargets.fiber_g
    };
  }
}
```

### 10.2 Meal Timing Engine

```typescript
// nutrition/mealTiming.ts

interface WorkoutSchedule {
  type: 'resistance' | 'cardio' | 'mixed';
  startTime: Date;
  duration_minutes: number;
  intensity: 'low' | 'moderate' | 'high';
}

interface MealRecommendation {
  timing: string;
  timing_minutes: number; // relative to workout
  protein_g: number;
  carbs_g: number;
  fat_g: number;
  notes: string[];
}

export class MealTimingEngine {
  static getPreWorkoutMeal(
    bodyweight_kg: number,
    workout: WorkoutSchedule
  ): MealRecommendation {
    const protein = Math.round(bodyweight_kg * 0.3);
    const carbs = Math.round(bodyweight_kg * (workout.type === 'cardio' ? 1.5 : 1.0));
    const fat = Math.round(bodyweight_kg * 0.15);
    
    return {
      timing: '1-2 hours before workout',
      timing_minutes: -90,
      protein_g: protein,
      carbs_g: carbs,
      fat_g: fat,
      notes: [
        'Include 2-3g leucine (whey, eggs, or BCAA)',
        'Lower fiber to prevent GI distress',
        'Hydrate: 500ml water 30 min before',
        workout.intensity === 'high' ? 'Consider 3-6mg/kg caffeine' : null
      ].filter(Boolean) as string[]
    };
  }
  
  static getPostWorkoutMeal(
    bodyweight_kg: number,
    workout: WorkoutSchedule
  ): MealRecommendation {
    const isResistance = workout.type === 'resistance' || workout.type === 'mixed';
    const protein = Math.round(bodyweight_kg * 0.4);
    const carbs = Math.round(bodyweight_kg * (isResistance ? 0.8 : 1.2));
    
    return {
      timing: 'Within 2 hours post-workout',
      timing_minutes: 60,
      protein_g: protein,
      carbs_g: carbs,
      fat_g: 10, // Keep fat low post-workout
      notes: [
        'Prioritize fast-digesting protein (whey, egg whites)',
        'High-GI carbs for glycogen replenishment',
        'Aim for 2.5-3g leucine minimum',
        'Rehydrate: 150% of fluid lost'
      ]
    };
  }
  
  static distributeDailyProtein(
    totalProtein: number,
    mealsPerDay: number,
    bodyweight_kg: number
  ): number[] {
    // Ensure each meal hits leucine threshold (~3g = ~25-30g protein)
    const minPerMeal = Math.min(30, bodyweight_kg * 0.4);
    const baseAmount = Math.max(minPerMeal, totalProtein / mealsPerDay);
    
    const distribution: number[] = [];
    let remaining = totalProtein;
    
    for (let i = 0; i < mealsPerDay; i++) {
      if (i === mealsPerDay - 1) {
        distribution.push(Math.round(remaining));
      } else {
        const amount = Math.round(baseAmount);
        distribution.push(amount);
        remaining -= amount;
      }
    }
    
    return distribution;
  }
}
```

### 10.3 Hydration Calculator

```typescript
// nutrition/hydration.ts

interface SweatTest {
  preWeight_kg: number;
  postWeight_kg: number;
  fluidConsumed_ml: number;
  urineVolume_ml: number;
  exerciseDuration_minutes: number;
}

interface HydrationPlan {
  dailyBaseline_ml: number;
  perWorkout_ml: number;
  electrolyteSodium_mg: number;
  electrolytePotassium_mg: number;
}

export class HydrationCalculator {
  static calculateSweatRate(test: SweatTest): number {
    const weightLoss_ml = (test.preWeight_kg - test.postWeight_kg) * 1000;
    const netFluidLoss = weightLoss_ml - test.fluidConsumed_ml + test.urineVolume_ml;
    return Math.round(netFluidLoss / (test.exerciseDuration_minutes / 60));
  }
  
  static getHydrationPlan(
    bodyweight_kg: number,
    workoutDuration_minutes: number,
    intensity: 'low' | 'moderate' | 'high',
    climate: 'cool' | 'moderate' | 'hot'
  ): HydrationPlan {
    // Baseline: 35-40ml per kg
    const baseline = Math.round(bodyweight_kg * 37);
    
    // Workout needs based on intensity and climate
    const intensityMultiplier = { low: 0.5, moderate: 0.8, high: 1.2 };
    const climateMultiplier = { cool: 0.8, moderate: 1.0, hot: 1.3 };
    
    const workoutPerHour = 500 * intensityMultiplier[intensity] * climateMultiplier[climate];
    const workoutTotal = Math.round((workoutDuration_minutes / 60) * workoutPerHour);
    
    // Electrolytes scale with sweat rate
    const sodiumBase = intensity === 'high' ? 700 : 400;
    const sodium = Math.round(sodiumBase * climateMultiplier[climate]);
    
    return {
      dailyBaseline_ml: baseline,
      perWorkout_ml: workoutTotal,
      electrolyteSodium_mg: sodium,
      electrolytePotassium_mg: Math.round(sodium / 3) // ~3:1 ratio
    };
  }
  
  static getHydrationReminderSchedule(
    workoutDuration_minutes: number
  ): number[] {
    // Return minutes from start when to remind
    const reminders: number[] = [];
    const interval = workoutDuration_minutes > 60 ? 20 : 15;
    
    for (let i = interval; i < workoutDuration_minutes; i += interval) {
      reminders.push(i);
    }
    
    return reminders;
  }
}
```

### 10.4 Adherence Tracking & Gamification

```typescript
// nutrition/adherence.ts

interface DailyLog {
  date: string;
  caloriesConsumed: number;
  proteinConsumed: number;
  targetCalories: number;
  targetProtein: number;
  workoutsCompleted: number;
  mealsLogged: number;
  water_ml: number;
}

interface AdherenceScore {
  overall: number; // 0-100
  calorieAccuracy: number;
  proteinAccuracy: number;
  consistency: number; // based on logging streak
  workoutCompliance: number;
  tier: 'bronze' | 'silver' | 'gold' | 'platinum';
}

export class AdherenceEngine {
  // Allow 10% variance for psychological flexibility
  static readonly CALORIE_TOLERANCE = 0.10;
  static readonly PROTEIN_TOLERANCE = 0.15;
  
  static calculateAdherenceScore(logs: DailyLog[]): AdherenceScore {
    if (logs.length === 0) {
      return {
        overall: 0,
        calorieAccuracy: 0,
        proteinAccuracy: 0,
        consistency: 0,
        workoutCompliance: 0,
        tier: 'bronze'
      };
    }
    
    // Calorie accuracy (closer to target = higher score)
    const calorieScores = logs.map(log => {
      const ratio = log.caloriesConsumed / log.targetCalories;
      const deviation = Math.abs(1 - ratio);
      return Math.max(0, 100 - (deviation * 200)); // 0% dev = 100, 50% dev = 0
    });
    const calorieAccuracy = this.average(calorieScores);
    
    // Protein accuracy (hitting minimum is priority)
    const proteinScores = logs.map(log => {
      const ratio = log.proteinConsumed / log.targetProtein;
      if (ratio >= 1) return 100;
      return Math.max(0, ratio * 100);
    });
    const proteinAccuracy = this.average(proteinScores);
    
    // Consistency streak bonus
    const streak = this.calculateStreak(logs);
    const consistency = Math.min(100, streak * 10);
    
    // Workout compliance
    const workoutScores = logs.map(log => {
      return log.workoutsCompleted > 0 ? 100 : 50; // Partial credit for rest days
    });
    const workoutCompliance = this.average(workoutScores);
    
    // Weighted overall score
    const overall = Math.round(
      calorieAccuracy * 0.25 +
      proteinAccuracy * 0.35 +
      consistency * 0.20 +
      workoutCompliance * 0.20
    );
    
    return {
      overall,
      calorieAccuracy: Math.round(calorieAccuracy),
      proteinAccuracy: Math.round(proteinAccuracy),
      consistency: Math.round(consistency),
      workoutCompliance: Math.round(workoutCompliance),
      tier: this.getTier(overall)
    };
  }
  
  static getTier(score: number): AdherenceScore['tier'] {
    if (score >= 90) return 'platinum';
    if (score >= 80) return 'gold';
    if (score >= 70) return 'silver';
    return 'bronze';
  }
  
  static getRewards(tier: AdherenceScore['tier']): string[] {
    const rewards: Record<string, string[]> = {
      bronze: ['Basic tracking access', 'Weekly summary'],
      silver: ['+ Meal planning templates', '+ Progress photos'],
      gold: ['+ Advanced analytics', '+ Custom recipes', '+ Priority support'],
      platinum: ['+ 1-on-1 coaching discount', '+ Early feature access', '+ VIP community']
    };
    return rewards[tier];
  }
  
  private static average(values: number[]): number {
    return values.reduce((a, b) => a + b, 0) / values.length;
  }
  
  private static calculateStreak(logs: DailyLog[]): number {
    // Simplified - count consecutive days with any logging
    let streak = 0;
    for (let i = logs.length - 1; i >= 0; i--) {
      if (logs[i].mealsLogged > 0) {
        streak++;
      } else {
        break;
      }
    }
    return streak;
  }
}
```

### 10.5 Nutrition API Integration (USDA)

```typescript
// nutrition/usdaApi.ts

const USDA_API_KEY = process.env.USDA_API_KEY;
const USDA_BASE_URL = 'https://api.nal.usda.gov/fdc/v1';

interface FoodSearchResult {
  fdcId: number;
  description: string;
  dataType: string;
  brandName?: string;
  ingredients?: string;
  servingSize?: number;
  servingSizeUnit?: string;
  nutrients: {
    nutrientId: number;
    nutrientName: string;
    value: number;
    unitName: string;
  }[];
}

interface SimplifiedNutrition {
  name: string;
  calories: number;
  protein_g: number;
  carbs_g: number;
  fat_g: number;
  fiber_g: number;
  serving_size: string;
}

export class USDANutritionAPI {
  static async searchFoods(query: string, pageSize: number = 10): Promise<FoodSearchResult[]> {
    const url = new URL(`${USDA_BASE_URL}/foods/search`);
    url.searchParams.append('api_key', USDA_API_KEY!);
    url.searchParams.append('query', query);
    url.searchParams.append('pageSize', pageSize.toString());
    url.searchParams.append('dataType', 'Foundation,SR%20Legacy');
    
    const response = await fetch(url.toString());
    const data = await response.json();
    
    return data.foods || [];
  }
  
  static simplifyNutrition(food: FoodSearchResult): SimplifiedNutrition {
    const getNutrient = (name: string) => {
      const nutrient = food.nutrients.find(n => 
        n.nutrientName.toLowerCase().includes(name.toLowerCase())
      );
      return nutrient ? nutrient.value : 0;
    };
    
    return {
      name: food.description,
      calories: getNutrient('Energy') || getNutrient('energy'),
      protein_g: getNutrient('Protein'),
      carbs_g: getNutrient('Carbohydrate'),
      fat_g: getNutrient('Total lipid'),
      fiber_g: getNutrient('Fiber'),
      serving_size: food.servingSize 
        ? `${food.servingSize}${food.servingSizeUnit || 'g'}`
        : '100g'
    };
  }
  
  // Cache common bodybuilding foods
  static readonly BODYBUILDING_STAPLES = [
    'chicken breast',
    'brown rice',
    'oats',
    'egg white',
    'salmon',
    'sweet potato',
    'greek yogurt',
    'whey protein',
    'broccoli',
    'banana',
    'almonds',
    'tuna'
  ];
}
```

### 10.6 Budget Meal Plan Generator

```typescript
// nutrition/budgetMeals.ts

interface BudgetConstraint {
  dailyBudget: number; // USD
  days: number;
  targetCalories: number;
  targetProtein: number;
}

interface FoodItem {
  name: string;
  costPerServing: number; // USD
  calories: number;
  protein: number;
  carbs: number;
  fat: number;
  servingsPerUnit: number;
}

const BUDGET_FOODS: FoodItem[] = [
  { name: 'Chicken thighs (frozen)', costPerServing: 0.90, calories: 200, protein: 26, carbs: 0, fat: 10, servingsPerUnit: 4 },
  { name: 'Eggs (large)', costPerServing: 0.25, calories: 70, protein: 6, carbs: 0.5, fat: 5, servingsPerUnit: 12 },
  { name: 'Oats (old fashioned)', costPerServing: 0.15, calories: 150, protein: 5, carbs: 27, fat: 2.5, servingsPerUnit: 30 },
  { name: 'Rice (white, bulk)', costPerServing: 0.10, calories: 200, protein: 4, carbs: 45, fat: 0.5, servingsPerUnit: 20 },
  { name: 'Canned tuna', costPerServing: 0.80, calories: 100, protein: 22, carbs: 0, fat: 1, servingsPerUnit: 2.5 },
  { name: 'Peanut butter', costPerServing: 0.20, calories: 190, protein: 7, carbs: 7, fat: 16, servingsPerUnit: 14 },
  { name: 'Frozen broccoli', costPerServing: 0.30, calories: 30, protein: 2, carbs: 6, fat: 0, servingsPerUnit: 4 },
  { name: 'Milk (gallon)', costPerServing: 0.25, calories: 150, protein: 8, carbs: 12, fat: 8, servingsPerUnit: 16 },
  { name: 'Bananas', costPerServing: 0.20, calories: 105, protein: 1, carbs: 27, fat: 0, servingsPerUnit: 1 },
  { name: 'Potatoes', costPerServing: 0.25, calories: 160, protein: 4, carbs: 37, fat: 0, servingsPerUnit: 5 },
  { name: 'Lentils (dry)', costPerServing: 0.20, calories: 230, protein: 18, carbs: 40, fat: 0.8, servingsPerUnit: 10 },
  { name: 'Whey protein (bulk)', costPerServing: 0.90, calories: 120, protein: 24, carbs: 3, fat: 1, servingsPerUnit: 70 }
];

export class BudgetMealGenerator {
  static generateBudgetPlan(constraint: BudgetConstraint) {
    const dailyBudget = constraint.dailyBudget;
    const targetCalories = constraint.targetCalories;
    const targetProtein = constraint.targetProtein;
    
    // Sort by protein per dollar (efficiency)
    const proteinEfficiency = BUDGET_FOODS.map(food => ({
      ...food,
      proteinPerDollar: food.protein / food.costPerServing,
      caloriesPerDollar: food.calories / food.costPerServing
    })).sort((a, b) => b.proteinPerDollar - a.proteinPerDollar);
    
    const plan = {
      dailyItems: [] as { food: FoodItem; servings: number }[],
      dailyCost: 0,
      totalCalories: 0,
      totalProtein: 0,
      shoppingList: {} as Record<string, number>
    };
    
    // First pass: Meet protein requirements with most efficient sources
    let remainingProtein = targetProtein;
    let remainingCalories = targetCalories;
    
    for (const food of proteinEfficiency) {
      if (remainingProtein <= 0) break;
      
      const servingsNeeded = Math.min(
        Math.ceil(remainingProtein / food.protein),
        Math.floor((dailyBudget - plan.dailyCost) / food.costPerServing)
      );
      
      if (servingsNeeded > 0) {
        plan.dailyItems.push({ food, servings: servingsNeeded });
        plan.dailyCost += servingsNeeded * food.costPerServing;
        remainingProtein -= servingsNeeded * food.protein;
        remainingCalories -= servingsNeeded * food.calories;
      }
    }
    
    // Calculate shopping list for the week
    plan.dailyItems.forEach(({ food, servings }) => {
      const unitsNeeded = Math.ceil((servings * constraint.days) / food.servingsPerUnit);
      plan.shoppingList[food.name] = unitsNeeded;
    });
    
    // Calculate totals
    plan.totalCalories = plan.dailyItems.reduce((sum, item) => 
      sum + (item.food.calories * item.servings), 0);
    plan.totalProtein = plan.dailyItems.reduce((sum, item) => 
      sum + (item.food.protein * item.servings), 0);
    
    return {
      ...plan,
      weeklyCost: plan.dailyCost * constraint.days,
      proteinEfficiencyRanking: proteinEfficiency.slice(0, 5).map(f => ({
        name: f.name,
        proteinPerDollar: f.proteinPerDollar.toFixed(1)
      }))
    };
  }
}
```

---

## 11. Implementation Recommendations for Fitness RPG App

### 11.1 Core Features Priority

**Phase 1 (MVP):**
1. Macro calculator with scientific formulas
2. Basic food logging with USDA integration
3. Daily target tracking (calories, protein)
4. Simple adherence scoring

**Phase 2:**
1. Meal timing recommendations
2. Pre/post workout nutrition guidance
3. Hydration tracking
4. Budget meal planning

**Phase 3:**
1. Advanced calorie cycling
2. Refeed day scheduling
3. Community features
4. Gamification and rewards

### 11.2 Database Schema (Suggested)

```sql
-- User profiles with fitness goals
CREATE TABLE user_profiles (
  id UUID PRIMARY KEY,
  weight_kg DECIMAL(5,2),
  target_weight_kg DECIMAL(5,2),
  body_fat_percentage DECIMAL(4,2),
  activity_level VARCHAR(20),
  goal VARCHAR(20), -- 'lose', 'maintain', 'gain'
  created_at TIMESTAMP
);

-- Daily nutrition targets
CREATE TABLE daily_targets (
  id UUID PRIMARY KEY,
  user_id UUID REFERENCES user_profiles(id),
  date DATE,
  calories INTEGER,
  protein_g INTEGER,
  carbs_g INTEGER,
  fat_g INTEGER,
  is_training_day BOOLEAN
);

-- Food logs
CREATE TABLE food_logs (
  id UUID PRIMARY KEY,
  user_id UUID REFERENCES user_profiles(id),
  food_name VARCHAR(255),
  calories INTEGER,
  protein_g DECIMAL(6,2),
  carbs_g DECIMAL(6,2),
  fat_g DECIMAL(6,2),
  logged_at TIMESTAMP
);

-- Workout sessions for integration
CREATE TABLE workouts (
  id UUID PRIMARY KEY,
  user_id UUID REFERENCES user_profiles(id),
  type VARCHAR(50),
  start_time TIMESTAMP,
  duration_minutes INTEGER,
  intensity VARCHAR(20)
);

-- Adherence scores for gamification
CREATE TABLE adherence_scores (
  id UUID PRIMARY KEY,
  user_id UUID REFERENCES user_profiles(id),
  week_start DATE,
  overall_score INTEGER,
  tier VARCHAR(20),
  streak_days INTEGER
);
```

### 11.3 API Integration Architecture

```
┌─────────────────┐     ┌──────────────────┐     ┌─────────────────┐
│   Mobile App    │────▶│  Your Backend    │────▶│  USDA API       │
│                 │     │                  │     │  (Primary)      │
└─────────────────┘     │  - Macro Calc    │     └─────────────────┘
                        │  - Meal Timing   │
                        │  - Adherence     │     ┌─────────────────┐
                        └──────────────────┘────▶│  Edamam API     │
                                │                │  (Fallback)     │
                                ▼                └─────────────────┘
                        ┌──────────────────┐
                        │  Database        │
                        │  - User data     │
                        │  - Food logs     │
                        │  - Workouts      │
                        └──────────────────┘
```

---

## 12. Summary of Key Recommendations

### For Muscle Gain:
- Calories: TDEE + 300-500 (10-20% surplus)
- Protein: 1.6-2.2 g/kg/day
- Carbs: 55-60% of calories (≥3-5 g/kg/day)
- Fat: 15-20% of calories
- Meal frequency: 4-6 meals with 0.4-0.55 g/kg protein per meal

### For Fat Loss:
- Calories: TDEE - 500 (0.5kg/week target)
- Protein: 2.0-2.4 g/kg/day (preserve muscle)
- Carbs: Maintain for training intensity
- Fat: 20-25% minimum (hormone support)
- Refeeds: Every 7-14 days during extended deficits

### For Hydration:
- Baseline: 35-40 ml/kg bodyweight
- During exercise: Replace 150% of sweat loss
- Electrolytes: 400-800mg sodium/hour for intense training

### For Adherence:
- Allow 10-15% flexibility in targets
- Focus on protein minimums, calorie ranges
- Build habits gradually (1-2 changes at a time)
- Track non-scale progress
- Use gamification for engagement

---

## References

1. Lambert CP, et al. (2004). Macronutrient considerations for the sport of bodybuilding. Sports Medicine.
2. Slater G, et al. (2019). Nutrition recommendations for bodybuilders in the off-season. Sports Journal.
3. International Society of Sports Nutrition Position Stand: Protein and Exercise (PMC2117006)
4. Effects of diet macronutrient composition on body composition (PMC3735822)
5. Behavioral Weight Loss and Maintenance: 25-Year Research Program (PMC9662257)
6. Role of Functional Beverages on Sport Performance (PMC6213308)
7. Examine.com - Optimal Protein Intake Guide
8. Precision Hydration - Electrolyte research

---

*Research compiled for fitness RPG nutrition guidance feature. All formulas and recommendations are evidence-based from peer-reviewed sources.*
